!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("chart.js"),require("moment")):"function"==typeof define&&define.amd?define(["chart.js","moment"],e):e(t.Chart,t.moment)}(this,function(t,e){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e;const a=t.helpers;a.isArray;var i=t.helpers.color;function r(t,i){if(a.isNullOrUndef(t))return null;var r=i.options.time,o=function(t,a){var i=a.parser,r=a.parser||a.format;return"function"==typeof i?i(t):"string"==typeof t&&"string"==typeof r?e(t,r):(t instanceof e||(t=e(t)),t.isValid()?t:"function"==typeof r?r(t):t)}(i.getRightValue(t),r);return o.isValid()?(r.round&&o.startOf(r.round),o.valueOf()):null}var o=Number.MIN_SAFE_INTEGER||-9007199254740991,n=Number.MAX_SAFE_INTEGER||9007199254740991,l=t.scaleService.getScaleConstructor("time").extend({determineDataLimits:function(){var t,a,i,l,s,d,c,h=this,u=h.chart,f=h.options.time,m=h.chart.options.elements,p=n,g=o,y=[],b={},x=[];for(t=0,i=(u.data.datasets||[]).length;t<i;++t)if(u.isDatasetVisible(t))for(s=u.data.datasets[t].data,x[t]=[],a=0,l=s.length;a<l;++a)(d=r(s[a][m.keyStart],h))>(c=r(s[a][m.keyEnd],h))&&([d,c]=[c,d]),p>d&&d&&(p=d),g<c&&c&&(g=c),x[t][a]=[d,c,s[a][m.keyValue]],Object.prototype.hasOwnProperty.call(b,d)&&(b[d]=!0,y.push(d)),Object.prototype.hasOwnProperty.call(b,c)&&(b[c]=!0,y.push(c));else x[t]=[];y.size&&y.sort(function(t,e){return t-e}),p=r(f.min,h)||p,g=r(f.max,h)||g,p=p===n?+e().startOf("day"):p,g=g===o?+e().endOf("day")+1:g,h.min=Math.min(p,g),h.max=Math.max(p+1,g),h._horizontal=h.isHorizontal(),h._table=[],h._timestamps={data:y,datasets:x,labels:[]}}});t.scaleService.registerScaleType("timeline",l,{position:"bottom",tooltips:{mode:"nearest"},adapters:{},time:{parser:!1,format:!1,unit:!1,round:!1,displayFormat:!1,isoWeekday:!1,minUnit:"millisecond",distribution:"linear",bounds:"data",displayFormats:{millisecond:"h:mm:ss.SSS a",second:"h:mm:ss a",minute:"h:mm a",hour:"hA",day:"MMM D",week:"ll",month:"MMM YYYY",quarter:"[Q]Q - YYYY",year:"YYYY"}},ticks:{autoSkip:!0}}),t.controllers.timeline=t.controllers.bar.extend({getBarBounds:function(t){var e,a,i=t._view;return e=i.x,a=i.x+i.width,{left:e,top:i.y,right:a,bottom:i.y+i.height}},update:function(e){var i=this,r=i.getMeta(),o=i.chart.options;if(o.textPadding||o.minBarWidth||o.showText||o.colorFunction){var n=i.chart.options.elements;n.textPadding=o.textPadding||n.textPadding,n.minBarWidth=o.minBarWidth||n.minBarWidth,n.colorFunction=o.colorFunction||n.colorFunction,n.minBarWidth=o.minBarWidth||n.minBarWidth,!0!==t._tl_depwarn&&(console.log("Timeline Chart: Configuration deprecated. Please check document on Github."),t._tl_depwarn=!0)}a.each(r.data,function(t,a){i.updateElement(t,a,e)},i)},updateElement:function(e,r,o){var n=this,l=n.getMeta(),s=n.getScaleForId(l.xAxisID),d=n.getScaleForId(l.yAxisID),c=n.getDataset(),h=c.data[r],u=e.custom||{},f=n.index,m=n.chart.options.elements||t.defaults.timeline.elements,p=m.rectangle,g=m.textPadding,y=m.minBarWidth;e._xScale=s,e._yScale=d,e._datasetIndex=n.index,e._index=r;var b=h[m.keyValue],x=n.getRuler(r),v=s.getPixelForValue(h[m.keyStart]),k=s.getPixelForValue(h[m.keyEnd]),S=d.getPixelForValue(h,f,f),w=k-v,_=n.calculateBarHeight(x),P=i(m.colorFunction(b,h,c,r)),B=m.showText,C=m.font;C||(C='bold 12px "Helvetica Neue", Helvetica, Arial, sans-serif');var W=S-_/2;e._model={x:o?v-w:v,y:W,width:Math.max(w,y),height:_,base:v+w,backgroundColor:P.rgbaString(),borderSkipped:u.borderSkipped?u.borderSkipped:p.borderSkipped,borderColor:u.borderColor?u.borderColor:a.getValueAtIndexOrDefault(c.borderColor,r,p.borderColor),borderWidth:u.borderWidth?u.borderWidth:a.getValueAtIndexOrDefault(c.borderWidth,r,p.borderWidth),label:n.chart.data.labels[r],datasetLabel:c.label,text:b,textColor:P.luminosity()>.5?"#000000":"#ffffff"},e.draw=function(){var t=this._chart.ctx,e=this._view,a=t.globalAlpha,i=t.globalCompositeOperation;if(t.fillStyle=e.backgroundColor,t.lineWidth=e.borderWidth,t.globalCompositeOperation="destination-over",t.fillRect(e.x,e.y,e.width,e.height),t.globalAlpha=.5,t.globalCompositeOperation="source-over",t.fillRect(e.x,e.y,e.width,e.height),t.globalAlpha=a,t.globalCompositeOperation=i,B){t.beginPath();var r=t.measureText(e.text);r.width>0&&r.width+g+2<e.width&&(t.font=C,t.fillStyle=e.textColor,t.lineWidth=0,t.strokeStyle=e.textColor,t.textBaseline="middle",t.fillText(e.text,e.x+g,e.y+e.height/2)),t.fill()}},e.inXRange=function(t){var e=n.getBarBounds(this);return t>=e.left&&t<=e.right},e.tooltipPosition=function(){var t=this.getCenterPoint();return{x:t.x,y:t.y}},e.getCenterPoint=function(){var t=this._view;return{x:t.x+t.width/2,y:t.y+t.height/2}},e.inRange=function(t,e){var a=!1;if(this._view){var i=n.getBarBounds(this);a=t>=i.left&&t<=i.right&&e>=i.top&&e<=i.bottom}return a},e.pivot()},getBarCount:function(){var t=this,e=0;return a.each(t.chart.data.datasets,function(a,i){t.chart.getDatasetMeta(i).bar&&t.chart.isDatasetVisible(i)&&++e},t),e},draw:function(t){var e,a,i=t||1,r=this.getMeta().data;for(e=0,a=r.length;e<a;e++)r[e].transition(i).draw()},calculateBarHeight:function(t){var e=this.getScaleForId(this.getMeta().yAxisID);return e.options.barThickness?e.options.barThickness:e.options.stacked?t.categoryHeight:t.barHeight},removeHoverStyle:function(t){},setHoverStyle:function(t){}}),t.defaults.timeline={elements:{colorFunction:function(){return i("black")},showText:!0,textPadding:4,minBarWidth:1,keyStart:0,keyEnd:1,keyValue:2},layout:{padding:{left:0,right:0,top:0,bottom:0}},legend:{display:!1},scales:{xAxes:[{type:"timeline",position:"bottom",distribution:"linear",categoryPercentage:.8,barPercentage:.9,gridLines:{display:!0,drawBorder:!0,drawTicks:!0},ticks:{maxRotation:0},unit:"day"}],yAxes:[{type:"category",position:"left",barThickness:20,categoryPercentage:.8,barPercentage:.9,offset:!0,gridLines:{display:!0,offsetGridLines:!0,drawBorder:!0,drawTicks:!0}}]},tooltips:{callbacks:{title:function(t,e){this._chart.options.elements;return e.labels[t[0].datasetIndex]},label:function(t,a){var i=this._chart.options.elements,r=a.datasets[t.datasetIndex].data[t.index];return[r[i.keyValue],e(r[i.keyStart]).format("L LTS"),e(r[i.keyEnd]).format("L LTS")]}}}}});
